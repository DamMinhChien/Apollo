<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hồ sơ</title>
    <link rel="icon" href="./assets/images/logo/favicon.png">
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./assets/css/animate.min.css">
    <link rel="stylesheet" href="./assets/css/owl.carousel.min.css">
    <script src="./assets/js/colorMap.js"></script>
    <script src="./assets/js/jquery.min.js"></script>
    <link rel="stylesheet" href="./assets/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <style>
        #avatar-preview {
            border: 2px solid #dee2e6;
            margin-top: 5px;
        }

        .is-valid {
            border-color: #28a745 !important;
        }

        .is-invalid {
            border-color: #dc3545 !important;
        }
    </style>
</head>

<body>
    <div id="wrapper" class="text-dark">
        <!--Menu-->
        <header></header>
        <!--Content-->
        <div class="container" style="margin-top: 7rem;">
            <div class="flat-title flat-title-gradient text-center p-3">
                <h1>Hồ Sơ Của Tôi</h1>
                <p>Quản lý thông tin hồ sơ để bảo mật tài khoản</p>
            </div>
        </div>
        <section class="container my-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-7">
                        <h3 class="mb-3">Thông tin đăng nhập</h3>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="email" placeholder="Email đăng nhập" required>
                            <label for="email">Email đăng nhập<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="password" placeholder="Mật khẩu" required>
                            <label for="password">Mật khẩu<span style="color: red;">*</span></label>
                        </div>
                        <h3 class="mb-3">Thông tin nhận hàng</h3>
                        <div class="address d-flex justify-content-between me-5 flex-wrap">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="province" required>
                                    <option value="">Chọn Tỉnh/Thành phố</option>
                                </select>
                                <label for="province">Tỉnh/Thành phố<span style="color: red;">*</span></label>
                            </div>
                            <div class="form-floating mb-3">
                                <select class="form-select" id="district" required>
                                    <option value="">Chọn Quận/Huyện</option>
                                </select>
                                <label for="district">Quận/Huyện<span style="color: red;">*</span></label>
                            </div>
                            <div class="form-floating mb-3">
                                <select class="form-select" id="ward" required>
                                    <option value="">Chọn Phường/Xã</option>
                                </select>
                                <label for="ward">Phường/Xã<span style="color: red;">*</span></label>
                            </div>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" style="width: 70%;" id="address"
                                placeholder="Địa chỉ cụ thể" required>
                            <label for="address">Địa chỉ cụ thể<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="tel" class="form-control" id="phone" placeholder="Số điện thoại" required>
                            <label for="phone">Số điện thoại<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="comment" placeholder="Thông tin thêm">
                            <label for="comment">Thông tin thêm</label>
                        </div>
                    </div>
                    <div class="col-md-4 offset-md-1">
                        <h3 class="mb-3">Thông tin cá nhân</h3>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="name" placeholder="Tên người dùng" required>
                            <label for="name">Tên người dùng<span style="color: red;">*</span></label>
                        </div>
                        <h5>Giới tính</h5>
                        <div class="d-flex gap-3 align-items-center mb-3">
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="male" name="gender" value="male"
                                    checked>
                                <label class="form-check-label" for="male">Nam</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="female" name="gender" value="female">
                                <label class="form-check-label" for="female">Nữ</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="avatar" class="form-label fw-bold">Ảnh cá nhân</label>
                            <div class="mt-2 text-center">
                                <img id="avatar-preview" src="./assets/images/best-seller/black-11.jpg"
                                    alt="Avatar Preview"
                                    style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">
                            </div>
                            <input class="form-control mt-2" type="file" id="avatar" accept="image/*">
                        </div>
                        <button class="btn btn-primary w-100" id="save">Lưu</button>
                    </div>
                </div>
            </div>
        </section>
        <!--Footer-->
        <hr>
        <footer class="mx-3 my-5"></footer>
        <!--Bottom Footer-->
        <hr>
        <div class="footer-bottom my-4"></div>
        <!--Scroll To Top Button-->
        <div id="progress">
            <span id="progress-value"><i class="bi bi-chevron-up"></i></span>
        </div>
    </div>

    <script>
        $(function () {
            // Load các thành phần chung
            $("header").load("navbar.html");
            $("footer").load("footer.html");
            $(".footer-bottom").load("footer-bottom.html");

            // Scroll to top
            $("#progress").click(function () {
                $("html, body").animate({ scrollTop: 0 }, 10);
            });

            // Gọi các hàm khởi tạo
            ShowNavbarWhenScroll();
            zoom();
            addressAPI();
            phoneCheck();

            // Tải danh sách tỉnh/thành phố
            $.get("https://provinces.open-api.vn/api/p/", function (data) {
                let provinceOptions = '<option value="">Chọn Tỉnh/Thành phố</option>';
                data.forEach(province => {
                    provinceOptions += `<option value="${province.code}">${province.name}</option>`;
                });
                $('#province').html(provinceOptions);
            });

            // Hiển thị ảnh xem trước khi chọn file
            $("#avatar").on("change", function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $("#avatar-preview").attr("src", e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Xử lý nút Lưu
            $("#save").click(function () {
                let isValid = true;
                let message = "";

                const email = $("#email").val().trim();
                const password = $("#password").val().trim();
                const province = $("#province").val();
                const district = $("#district").val();
                const ward = $("#ward").val();
                const address = $("#address").val().trim();
                const phone = $("#phone").val().trim();
                const name = $("#name").val().trim();

                // Kiểm tra dữ liệu
                if (!email || !/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/.test(email)) {
                    isValid = false;
                    message += "- Email không hợp lệ\n";
                    $("#email").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#email").addClass("is-valid").removeClass("is-invalid");
                }
                if (!password || password.length < 6) {
                    isValid = false;
                    message += "- Mật khẩu phải từ 6 ký tự\n";
                    $("#password").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#password").addClass("is-valid").removeClass("is-invalid");
                }
                if (!name) {
                    isValid = false;
                    message += "- Vui lòng nhập tên người dùng\n";
                    $("#name").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#name").addClass("is-valid").removeClass("is-invalid");
                }
                if (!province) {
                    isValid = false;
                    message += "- Vui lòng chọn Tỉnh/Thành phố\n";
                    $("#province").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#province").addClass("is-valid").removeClass("is-invalid");
                }
                if (!district) {
                    isValid = false;
                    message += "- Vui lòng chọn Quận/Huyện\n";
                    $("#district").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#district").addClass("is-valid").removeClass("is-invalid");
                }
                if (!ward) {
                    isValid = false;
                    message += "- Vui lòng chọn Phường/Xã\n";
                    $("#ward").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#ward").addClass("is-valid").removeClass("is-invalid");
                }
                if (!address) {
                    isValid = false;
                    message += "- Vui lòng nhập địa chỉ cụ thể\n";
                    $("#address").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#address").addClass("is-valid").removeClass("is-invalid");
                }
                if (!phone || !/^(03|05|07|08|09)\d{8}$/.test(phone)) {
                    isValid = false;
                    message += "- Số điện thoại không hợp lệ\n";
                    $("#phone").addClass("is-invalid").removeClass("is-valid");
                } else {
                    $("#phone").addClass("is-valid").removeClass("is-invalid");
                }

                if (!isValid) {
                    alert("Vui lòng kiểm tra lại thông tin:\n" + message);
                    return;
                }

                alert("Lưu thông tin thành công!");
                // Lưu thông tin vào localStorage hoặc gửi đến server
                const profileData = {
                    email,
                    password,
                    name,
                    province,
                    district,
                    ward,
                    address,
                    phone,
                    gender: $("input[name='gender']:checked").val(),
                    comment: $("#comment").val().trim(),
                    avatar: $("#avatar-preview").attr("src")
                };
                localStorage.setItem("profileData", JSON.stringify(profileData));
            });
        });

        function addressAPI() {
            // Khi chọn Tỉnh/Thành phố, lấy danh sách Quận/Huyện
            $('#province').on('change', function () {
                const provinceCode = $(this).val();
                if (provinceCode) {
                    $.get(`https://provinces.open-api.vn/api/d/`, function (data) {
                        let districtOptions = '<option value="">Chọn Quận/Huyện</option>';
                        data.filter(d => d.province_code == provinceCode).forEach(district => {
                            districtOptions += `<option value="${district.code}">${district.name}</option>`;
                        });
                        $('#district').html(districtOptions);
                        $('#ward').html('<option value="">Chọn Phường/Xã</option>');
                    });
                } else {
                    $('#district').html('<option value="">Chọn Quận/Huyện</option>');
                    $('#ward').html('<option value="">Chọn Phường/Xã</option>');
                }
            });

            // Khi chọn Quận/Huyện, lấy danh sách Phường/Xã
            $('#district').on('change', function () {
                const districtCode = $(this).val();
                if (districtCode) {
                    $.get(`https://provinces.open-api.vn/api/w/`, function (data) {
                        let wardOptions = '<option value="">Chọn Phường/Xã</option>';
                        data.filter(w => w.district_code == districtCode).forEach(ward => {
                            wardOptions += `<option value="${ward.code}">${ward.name}</option>`;
                        });
                        $('#ward').html(wardOptions);
                    });
                } else {
                    $('#ward').html('<option value="">Chọn Phường/Xã</option>');
                }
            });
        }

        function phoneCheck() {
            $('#phone').on('input', function () {
                const phone = $(this).val();
                const phoneRegex = /^(03|05|07|08|09)\d{8}$/;
                if (!phoneRegex.test(phone)) {
                    $(this).addClass('is-invalid').removeClass('is-valid');
                } else {
                    $(this).addClass('is-valid').removeClass('is-invalid');
                }
            });
        }

        function ShowNavbarWhenScroll() {
            let previousScroll = 0;
            $(window).scroll(function () {
                const currentScroll = $(this).scrollTop();
                if (currentScroll > previousScroll) {
                    $('.navbar').stop().slideUp(1000, "linear");
                } else {
                    $('.navbar').stop().slideDown(100, "linear");
                }
                previousScroll = currentScroll;
            });
        }

        function calcScrollValue() {
            const pos = $(document).scrollTop();
            const calcHeight = $(document).height() - $(window).height();
            const scrollValue = Math.round((pos / calcHeight) * 100);

            if (pos > 100) {
                $("#progress").fadeIn();
            } else {
                $("#progress").fadeOut();
            }
            $("#progress").css("background", `conic - gradient(#001a2e ${scrollValue} %, #f8f9fa ${scrollValue} %)`);
        }

        function zoom() {
            $("#avatar-preview").hover(
                function () {
                    $(this).css({
                        "transform": "scale(1.2)",
                        "transition": "0.3s ease"
                    });
                },
                function () {
                    $(this).css({
                        "transform": "scale(1)",
                        "transition": "0.3s ease"
                    });
                }
            );
        }

        $(window).on("scroll", calcScrollValue);
        $(window).on("load", calcScrollValue);
    </script>
    <script src="./assets/js/bootstrap.bundle.min.js"></script>
    <script src="./assets/js/owl.carousel.min.js"></script>
    <script src="./assets/js/script.js"></script>
</body>

</html>